---
layout: default
---
{% assign df = site.data.ui.date_format | default: "%b %-d, %Y" %}
<article class="k-post">
  <h1 class="k-post-title">{{ page.title | escape }}</h1>
  <p class="k-post-meta">
    <time class="k-post-date">{{ page.date | date: df }}</time>
    {% assign last_modified = page.last_modified_at | default: page.last_modified | default: page.updated %}
    {% if last_modified and last_modified != page.date %}
      <span class="k-post-sep">·</span>
      <time class="k-post-edit-date">最近更新 {{ last_modified | date: df }}</time>
    {% endif %}
  </p>
  {% if page.tags.size > 0 %}
  <div class="k-tags">
    {% for tag in page.tags %}
      <span class="k-tag">{{ tag }}</span>
    {% endfor %}
  </div>
  {% endif %}
  <div class="k-post-body">
    {{ content }}
  </div>
</article>

<!-- 相关文章 -->
{% assign related_posts = "" | split: "" %}
{% for tag in page.tags %}
  {% for site_tag in site.tags %}
    {% if site_tag[0] == tag %}
      {% for post in site_tag[1] %}
        {% unless post.url == page.url or related_posts contains post %}
          {% assign related_posts = related_posts | push: post %}
        {% endunless %}
      {% endfor %}
    {% endif %}
  {% endfor %}
{% endfor %}
{% assign related_posts = related_posts | sort: "date" | reverse | limit: 3 %}
{% if related_posts.size > 0 %}
<div class="k-related-posts">
  <h3 class="k-related-title">相关文章</h3>
  <div class="k-related-list">
    {% for post in related_posts %}
      <div class="k-related-item">
        <a href="{{ post.url | relative_url }}" class="k-related-link">{{ post.title }}</a>
        <div class="k-related-meta">
          <span class="k-related-date">{{ post.date | date: df }}</span>
          <div class="k-related-tags">
            {% for tag in post.tags limit: 3 %}
              <span class="k-tag k-tag-small">{{ tag }}</span>
            {% endfor %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- 相关标签 -->
{% assign all_tags = site.tags %}
{% assign related_tags = "" | split: "" %}
{% for tag in page.tags %}
  {% for site_tag in all_tags %}
    {% if site_tag[0] == tag %}
      {% for post in site_tag[1] %}
        {% unless post.url == page.url %}
          {% for post_tag in post.tags %}
            {% unless post_tag == tag or related_tags contains post_tag %}
              {% assign related_tags = related_tags | push: post_tag %}
            {% endunless %}
          {% endfor %}
        {% endunless %}
      {% endfor %}
    {% endif %}
  {% endfor %}
{% endfor %}

{% if related_tags.size > 0 %}
<div class="k-related-tags-section">
  <h3 class="k-related-title">相关标签</h3>
  <div class="k-tags">
    {% for tag in related_tags limit: 8 %}
      <span class="k-tag">{{ tag }}</span>
    {% endfor %}
  </div>
</div>
{% endif %}

{% include comments.html %}
